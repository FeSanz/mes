<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button autoHide="false">
        <ion-button size="large" (click)="ToggleMenu()">
          <ion-icon name="menu-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-menu-button>
    </ion-buttons>
    <ion-title>
      <ion-breadcrumbs>        
        <ion-breadcrumb href="/verification-codes">Códigos de acceso</ion-breadcrumb>
      </ion-breadcrumbs>
    </ion-title>    
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="ion-margin">
    <div>
      <p-table 
        #dtDB [value]="dbData.items" 
        dataKey="Id" 
        styleClass="card-table-primeng"
        class="ion-margin tabla-centrada" 
        [(selection)]="selectedCodes"
        [tableStyle]="{ 'min-width': '50rem'}" 
        [size]="'small'" 
        [rowHover]="true"
        [rows]="rowsPerPage" 
        [showCurrentPageReport]="true" 
        [rowsPerPageOptions]="rowsPerPageOptions" 
        [paginator]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} datos" 
        [filterDelay]="0"
        [globalFilterFields]="['Id', 'Code', 'UsedDate', 'CreatedDate']" 
        stripedRows [scrollable]="true"
        [scrollHeight]="GetScrollHeight()" 
        [alwaysShowPaginator]="true">

        <ng-template pTemplate="caption">
          <div class="table-caption-container">
            <div class="left-section">
              <p-button 
                [outlined]="true"
                icon="pi pi-filter-slash" 
                label="Limpiar" 
                (click)="ClearData(dtDB)" />

              <p-button
                [outlined]="true"
                icon="pi pi-plus-circle"
                label="Nuevo"
                variant="outlined"
                severity="info"
                (click)="AddCode()" />

            </div>
            <div class="right-section">

              <p-button
                    *ngIf="selectedCodes.length > 0"
                    [outlined]="true"
                    icon="pi pi-delete-left"
                    label="Eliminar"
                    variant="outlined"
                    severity="danger"
                    (click)="DeleteCodes()" />

              <p-iconField iconPosition="left">
                <p-inputIcon>
                  <i class="fas fa-search"></i>
                </p-inputIcon>
                <input pInputText 
                  type="text" 
                  [(ngModel)]="searchValueDB" 
                  (input)="OnFilterGlobal($event, dtDB)"
                  placeholder="Buscar" />
              </p-iconField>
            </div>
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th style="width: 4rem" class="td-center">
              <p-tableHeaderCheckbox/>
            </th>
            <th pSortableColumn="ID" style="min-width: 10rem">
              <div class="flex justify-between items-center">
                ID
                <p-sortIcon field="ID" />
                <p-columnFilter type="text" field="ID" display="menu" class="ml-auto" />
              </div>
            </th>
            <th pSortableColumn="Code" style="min-width: 10rem">
              <div class="flex justify-between items-center">
                Código
                <p-sortIcon field="Code" />
                <p-columnFilter type="text" field="Code" display="menu" class="ml-auto" />
              </div>
            </th>
            <th pSortableColumn="Company" style="min-width: 10rem">
              <div class="flex justify-between items-center">
                Compañía
                <p-sortIcon field="Company" />
                <p-columnFilter type="text" field="Company" display="menu" class="ml-auto" />
              </div>
            </th>
            <th pSortableColumn="CreatedDate" style="min-width: 10rem">
              <div class="flex justify-between items-center">
                Fecha de creación
                <p-sortIcon field="CreatedDate" />
                <p-columnFilter field="CreatedDate" matchMode="equals" display="menu" class="ml-auto" />
              </div>
            </th>  
            <th pSortableColumn="UsedDate" style="min-width: 10rem">
              <div class="flex justify-between items-center">
                Fecha de uso
                <p-sortIcon field="UsedDate" />
                <p-columnFilter field="UsedDate" matchMode="equals" display="menu" class="ml-auto" />
              </div>
            </th>            
            <th pSortableColumn="EnabledFlag" style="min-width: 14rem">
              <div class="flex justify-between items-center">
                Status
                <p-sortIcon field="EnabledFlag" />
                <p-columnFilter type="text" field="EnabledFlag" display="menu" class="ml-auto" />
              </div>
            </th>                   
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td class="td-center">
              <p-tableCheckbox [value]="item"/>
            </td>
            <td>{{ item.Id }}</td>            
            <td>{{ item.Code }}</td>
            <td>{{ item.Company }}</td>                        
            <td>{{ item.CreatedDate }}</td> 
            <td>{{ item.UsedDate }}</td> 
            <td>
              <ion-toggle [checked]="item.EnabledFlag == 'Y'" [disabled]="true" class="disabled-toggle"></ion-toggle>              
            </td> 
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5">No se encontraron códigos.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</ion-content>
