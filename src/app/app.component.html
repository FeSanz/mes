<ion-app>
  <p-toast></p-toast>
  <p-confirmDialog [style]="{ width: '450px' }" />
  <ion-split-pane contentId="main-content" when="(min-width: 2000px)">
    <ion-menu contentId="main-content" type="overlay" *ngIf="showMenu">
    <ion-header class="background-header">
      <ion-toolbar>
        <ion-title></ion-title>
      </ion-toolbar>
    </ion-header>
      <div class="menu-wrapper">
        <!-- Panel completo -->
        <div class="menu-panel">
          <!-- Header -->
          <div class="menu-header">
            <div class="menu-brand">
              <h2>MES</h2>
            </div>

            <!-- Separador -->
            <div class="menu-separator"></div>

            <!-- Usuario actual -->
            <ion-menu-toggle auto-hide="false">
              <div class="user-profile-section" [routerLink]="['/settings/user']">
                <ion-avatar>
                  <img src="../assets/images/avatar.png" alt="usuario" />
                </ion-avatar>
                <div class="user-details">
                  <h3>{{ username }}</h3>
                  <p>Ver perfil</p>
                </div>
                <ion-button fill="clear" id="popover-button-user" class="button-panel" (click)="$event.stopPropagation()">
                  <ion-icon name="ellipsis-vertical-outline"></ion-icon>
                </ion-button>
              </div>
            </ion-menu-toggle>

            <ion-popover trigger="popover-button-user" [dismissOnSelect]="true">
              <ng-template>
                <ion-content>
                  <ion-list>
                    <ion-menu-toggle auto-hide="false">
                      <ion-item [routerLink]="['/settings']" lines="none" detail="false" button>
                        <ion-icon slot="start" name="settings-outline" color="primary"></ion-icon>
                        <ion-label>Ajustes</ion-label>
                      </ion-item>
                    </ion-menu-toggle>
                    <ion-menu-toggle auto-hide="false">
                      <ion-item (click)="LogOut()" lines="none" detail="false" button>
                        <ion-icon slot="start" name="power-outline" color="danger"></ion-icon>
                        <ion-label>Salir</ion-label>
                      </ion-item>
                    </ion-menu-toggle>
                  </ion-list>
                </ion-content>
              </ng-template>
            </ion-popover>
          </div>

          <!-- Contenido del menú -->
          <ion-content style="height: calc(100vh - 275px);" class="menu-content">

            <!-- Sección de Navegación -->
            <div class="navigation-wrapper">
              <div class="navigation-title">
                <ion-text> NAVEGACIÓN</ion-text>
              </div>
              <!-- Acordeón de Tableros -->
              <ion-accordion-group [multiple]="true" [value]="['dash']">
                <ion-accordion value="dash">
                  <ion-item slot="header" lines="none" button class="menu-header-item">
                    <ion-icon slot="start" name="pie-chart-outline" class="menu-icon"></ion-icon>
                    <ion-label class="menu-label">Tableros</ion-label>
                    <ion-buttons slot="end" *ngIf="permissions.canEdit()">
                      <ion-button fill="clear" size="small" *ngIf="!editDashOrder" (click)="Reorder($event, true)">
                        <ion-icon slot="icon-only" name="layers-outline"></ion-icon>
                      </ion-button>
                      <ion-button fill="clear" size="small" *ngIf="editDashOrder" (click)="Reorder($event, false)">
                        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
                      </ion-button>
                    </ion-buttons>
                  </ion-item>

                  <div slot="content" class="accordion-content">
                    <ion-list class="menu-list">
                      <ion-menu-toggle auto-hide="false">
                        <ion-reorder-group [disabled]="false" (ionItemReorder)="handleReorder($event)">
                          <ion-item routerLinkActive="selected" detail="false" button lines="none" class="submenu-item"
                            *ngFor="let dashGroup of dashboardGroups; trackBy: trackByGroup"
                            (click)="GoToDashboards(dashGroup)"
                            [routerLink]="['/monitoring', dashGroup.dashboard_group_id]">
                            <ion-icon slot="start" name="stats-chart-outline"></ion-icon>
                            <ion-label>
                              <h3>{{ dashGroup.group_name }}</h3>
                              <p>{{ dashGroup.organization_name }}</p>
                            </ion-label>
                            <ion-buttons slot="end" *ngIf="permissions.canEdit()">
                              <ion-button fill="clear" size="small"
                                [style.display]="editDashOrder ? 'none' : 'inline-flex'" (click)="HandleClick($event)"
                                id="popover-${{dashGroup['dashboard_group_id']}}">
                                <ion-icon slot="icon-only" name="ellipsis-vertical-outline"></ion-icon>
                              </ion-button>
                            </ion-buttons>
                            <ion-reorder slot="end" *ngIf="editDashOrder"></ion-reorder>

                            <ion-popover trigger="popover-${{dashGroup['dashboard_group_id']}}"
                              [dismissOnSelect]="true">
                              <ng-template>
                                <ion-content>
                                  <ion-list>
                                    <ion-item [button]="true" [detail]="false" (click)="editDashGroup(dashGroup)"
                                      lines="none">
                                      <ion-icon slot="start" name="pencil-outline" color="primary"></ion-icon>
                                      <ion-label>Editar</ion-label>
                                    </ion-item>
                                    <ion-item [button]="true" [detail]="false"
                                      (click)="deleteDashGroup(dashGroup.dashboard_group_id)"
                                      *ngIf="permissions.isSuperAdmin()" lines="none">
                                      <ion-icon slot="start" name="trash-outline" color="danger"></ion-icon>
                                      <ion-label>Eliminar</ion-label>
                                    </ion-item>
                                  </ion-list>
                                </ion-content>
                              </ng-template>
                            </ion-popover>
                          </ion-item>
                        </ion-reorder-group>
                      </ion-menu-toggle>

                      <ion-menu-toggle auto-hide="false" (click)="setOpen(true)" *ngIf="!permissions.isViewer()">
                        <ion-item detail="false" button lines="none" class="submenu-item submenu-add-item">
                          <ion-icon slot="start" name="add-outline"></ion-icon>
                          <ion-label>Nuevo grupo de tableros</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                    </ion-list>
                  </div>
                </ion-accordion>

                <!-- Sensores -->
                <ion-accordion value="iot" *ngIf="!permissions.isViewer()">
                  <ion-item slot="header" lines="none" button class="menu-header-item">
                    <ion-icon slot="start" name="radio-outline" class="menu-icon"></ion-icon>
                    <ion-label class="menu-label">Sensores</ion-label>
                  </ion-item>
                  <div slot="content" class="accordion-content">
                    <ion-list class="menu-list">
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/devices']" routerLinkActive="selected" detail="false" button
                          lines="none" class="submenu-item">
                          <ion-icon slot="start" name="hardware-chip-outline"></ion-icon>
                          <ion-label>Dispositivos</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                    </ion-list>
                  </div>
                </ion-accordion>

                <!-- Manufactura -->
                <ion-accordion value="mfg" *ngIf="!permissions.isViewer()">
                  <ion-item slot="header" lines="none" button class="menu-header-item">
                    <ion-icon slot="start" name="cube-outline" class="menu-icon"></ion-icon>
                    <ion-label class="menu-label">Manufactura</ion-label>
                  </ion-item>
                  <div slot="content" class="accordion-content">
                    <ion-list class="menu-list">
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/production-campaign']" routerLinkActive="selected" detail="false"
                          button lines="none" class="submenu-item">
                          <ion-icon slot="start" name="calendar-outline"></ion-icon>
                          <ion-label>Campañas</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/fusion_production']" routerLinkActive="selected" detail="false"
                          button lines="none" class="submenu-item">
                          <ion-icon slot="start" name="trending-up-outline"></ion-icon>
                          <ion-label>Producción</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/dispatch_transaction']" routerLinkActive="selected" detail="false"
                          button lines="none" class="submenu-item">
                          <ion-icon slot="start" name="document-text-outline"></ion-icon>
                          <ion-label>Despachos</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/costs']" routerLinkActive="selected" detail="false" button
                          lines="none" class="submenu-item">
                          <ion-icon slot="start" name="cash-outline"></ion-icon>
                          <ion-label>Costos</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                    </ion-list>
                  </div>
                </ion-accordion>

                <!-- Mantenimiento -->
                <ion-accordion value="mtto" *ngIf="!permissions.isViewer()">
                  <ion-item slot="header" lines="none" button class="menu-header-item">
                    <ion-icon slot="start" name="hammer-outline" class="menu-icon"></ion-icon>
                    <ion-label class="menu-label">Mantenimiento</ion-label>
                  </ion-item>
                  <div slot="content" class="accordion-content">
                    <ion-list class="menu-list">
                      <ion-menu-toggle auto-hide="false">
                        <ion-item routerLinkActive="selected" detail="false" button [routerLink]="['/failures']"
                                  lines="none" class="submenu-item">
                          <ion-icon slot="start" name="warning-outline"></ion-icon>
                          <ion-label>Fallas</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                      <ion-menu-toggle auto-hide="false">
                        <ion-item routerLinkActive="selected" detail="false" button [routerLink]="['/alerts']"
                          lines="none" class="submenu-item">
                          <ion-icon slot="start" name="notifications-outline"></ion-icon>
                          <ion-label>Alertas</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                      <ion-menu-toggle auto-hide="false">
                        <ion-item routerLinkActive="selected" detail="false" button [routerLink]="['/kpis']"
                          lines="none" class="submenu-item">
                          <ion-icon slot="start" name="pie-chart-outline"></ion-icon>
                          <ion-label>KPIs</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                    </ion-list>
                  </div>
                </ion-accordion>

                <!-- Configuraciones -->
                <ion-accordion value="settings" *ngIf="!permissions.isViewer()">
                  <ion-item slot="header" lines="none" button class="menu-header-item">
                    <ion-icon slot="start" name="settings-outline" class="menu-icon"></ion-icon>
                    <ion-label class="menu-label">Configuraciones</ion-label>
                  </ion-item>
                  <div slot="content" class="accordion-content">
                    <ion-list class="menu-list">
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/settings/users']" routerLinkActive="selected" detail="false" button
                          lines="none" class="submenu-item">
                          <ion-icon slot="start" name="people-outline"></ion-icon>
                          <ion-label>Usuarios</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/settings/machines']" routerLinkActive="selected" detail="false"
                          button lines="none" class="submenu-item">
                          <ion-icon slot="start" name="build-outline"></ion-icon>
                          <ion-label>Máquinas</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                      <ion-menu-toggle auto-hide="false">
                        <ion-item [routerLink]="['/fusion_connection']" routerLinkActive="selected" detail="false"
                          button lines="none" class="submenu-item">
                          <ion-icon slot="start" name="git-network-outline"></ion-icon>
                          <ion-label>Integraciones</ion-label>
                        </ion-item>
                      </ion-menu-toggle>
                    </ion-list>
                  </div>
                </ion-accordion>
              </ion-accordion-group>
            </div>
          </ion-content>

          <!-- Footer -->
          <ion-footer class="menu-footer ion-no-border">
            <ion-toolbar>
              <ion-item lines="none">
                <ion-label>Servidor remoto</ion-label>
                <ion-toggle slot="end" [(ngModel)]="remoteServer" (ionChange)="ChangeServerMode()"
                  color="primary"></ion-toggle>
              </ion-item>
              <ion-item lines="none">
                <ion-label>Modo oscuro</ion-label>
                <ion-toggle slot="end" [(ngModel)]="darkMode" (ionChange)="ChangeColorMode()"
                  color="primary"></ion-toggle>
              </ion-item>
              <ion-item lines="none">
                <ion-note>Versión: 1.0.0</ion-note>
              </ion-item>
            </ion-toolbar>
          </ion-footer>
        </div>
      </div>

    </ion-menu>

    <ion-router-outlet id="main-content"></ion-router-outlet>

    <!-- Modal -->
    <ion-modal [isOpen]="isModalOpen" (ionModalWillDismiss)="isModalOpen = false" [focusTrap]="false">
      <ng-template>
        <ion-header>
          <ion-toolbar color="primary">
            <ion-title>Nuevo grupo de tableros</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="setOpen(false)">Cerrar</ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
          <ion-item>
            <ion-input type="text" placeholder="Nombre del tablero" [(ngModel)]="dashboardGroupData.group_name"
              style="text-align: right;">
              <div slot="label">
                <ion-text color="primary">Nombre:</ion-text>
              </div>
            </ion-input>
          </ion-item>
          <ion-item>
            <ion-textarea type="text" placeholder="Descripción" [(ngModel)]="dashboardGroupData.description"
              style="text-align: right;">
              <div slot="label">
                <ion-text color="primary">Descripción:</ion-text>
              </div>
            </ion-textarea>
          </ion-item>
          <ion-item [disabled]="!dashboardGroupData.isNew">
            <ion-select label="Organización:" class="select" color="primary"
              [(ngModel)]="dashboardGroupData.organization_id" interface="popover">
              <ion-select-option [value]="org.OrganizationId" *ngFor="let org of user.Company.Organizations">{{ org.Name
                }}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-fab slot="fixed" vertical="bottom" horizontal="start" *ngIf="!dashboardGroupData.isNew">
            <ion-fab-button (click)="deleteDashGroup()" color="danger">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-fab-button>
          </ion-fab>
          <ion-fab slot="fixed" vertical="bottom" horizontal="end">
            <ion-fab-button (click)="dashboardGroupData.isNew ? addNewWidgetGroup() : updateWidgetGroup()"
              color="success">
              <ion-icon name="checkmark"></ion-icon>
            </ion-fab-button>
          </ion-fab>
        </ion-content>
      </ng-template>
    </ion-modal>
  </ion-split-pane>
</ion-app>
