<ion-card [ngStyle]="{'border': '.2px solid'+ widgetData.color}">
  <ion-card-header [ngStyle]="{'background': widgetData.color}">
    <ion-toolbar style="--background: transparent;">
      <ion-buttons slot="end">
        <ion-button id="popover-spline-${{data['dashboard_id']}}" title="Opciones">
          <ion-icon color="light" slot="icon-only" name="ellipsis-vertical"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-card-title color="light">{{widgetData.name}} </ion-card-title>
    </ion-toolbar>
  </ion-card-header>

  <ion-card-content>
    <div class="humidity-container">
      <div class="gauge-section">
        <div>
          <svg width="360" height="200" viewBox="0 0 360 200" class="humidity-svg-gauge large">
            <path d="M 60 160 A 120 120 0 0 1 300 160" fill="none" stroke="#333" stroke-width="18"
              stroke-linecap="round" class="background-arc" />
            <path d="M 60 160 A 120 120 0 0 1 300 160" fill="none" [attr.stroke]="currentColor" stroke-width="18"
              stroke-linecap="round" [attr.stroke-dasharray]="getProgressDashArray((currentValue$ | async) ?? 0)"
              [attr.stroke-dashoffset]="0" class="progress-path" />
            <g class="scale-marks">
              <line x1="60" y1="160" x2="35" y2="160" stroke="#888" stroke-width="2" />
              <text x="30" y="165" fill="#aaa" font-size="10" text-anchor="end" font-weight="bold">
                {{ widgetData.sensors[0].min }}%
              </text>

              <line x1="95" y1="75" x2="82" y2="62" stroke="#888" stroke-width="1.5" />
              <text x="78" y="58" fill="#999" font-size="9" text-anchor="end">
                {{ getScaleValue(0.25) }}%
              </text>
              <line x1="180" y1="40" x2="180" y2="15" stroke="#888" stroke-width="2" />
              <text x="180" y="10" fill="#aaa" font-size="10" text-anchor="middle" font-weight="bold">
                {{ getScaleValue(0.5) }}%
              </text>
              <line x1="265" y1="75" x2="278" y2="62" stroke="#888" stroke-width="1.5" />
              <text x="282" y="58" fill="#999" font-size="9" text-anchor="start">
                {{ getScaleValue(0.75) }}%
              </text>
              <line x1="300" y1="160" x2="325" y2="160" stroke="#888" stroke-width="2" />
              <text x="330" y="165" fill="#aaa" font-size="10" text-anchor="start" font-weight="bold">
                {{ widgetData.sensors[0].max }}%
              </text>
            </g>
            <text x="180" y="115" text-anchor="middle" fill="#ccc" font-size="12" font-weight="600" opacity="0.8">
              {{widgetData.sensors[0].sensor_name}}
            </text>
            <text x="180" y="165" text-anchor="middle" [attr.fill]="currentColor" font-size="28" font-weight="bold"
              class="gauge-value">
              {{ (currentValue$ | async) ?? 0 | number:'1.1-1' }}%
            </text>
          </svg>
        </div>
      </div>
    </div> 
    <ion-item lines="none" style="align-self: stretch" class="ion-text-center">
      <ion-label color="medium">
        Última actualización: {{ lastDate | date: "d 'de' MMMM 'a las' h:mm a" }}
      </ion-label>
    </ion-item>
  </ion-card-content>
</ion-card>
<ion-popover trigger="popover-spline-${{data['dashboard_id']}}" [dismissOnSelect]="true" showBackdrop="false">
  <ng-template>
    <ion-content>
      <ion-list>
        <ion-item [button]="true" [detail]="false" (click)="editChart()">Editar <ion-icon slot="start"
            name="pencil-outline" color="success"></ion-icon></ion-item>
        <ion-item [button]="true" [detail]="false" (click)="deleteChart()">Eliminar <ion-icon slot="start"
            name="trash-outline" color="danger"></ion-icon></ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-popover>