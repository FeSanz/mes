<ion-header [translucent]="true" style="box-shadow: none !important;" xmlns="http://www.w3.org/1999/html">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button autoHide="false">
        <ion-button size="large" (click)="ToggleMenu()">
          <ion-icon name="menu-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-menu-button>
    </ion-buttons>
    <ion-title>Fallas {{userData.Company.Name}}</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true">
  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <ion-card>
          <p-table #dtFailures
                   [value]="failuresData.items"
                   [(selection)]="selectedFailures"
                   dataKey="failure_id"
                   styleClass="card-table-primeng wo-table-custom"
                   [tableStyle]="{ 'height': '100%'}"
                   [size]="'small'"
                   [rowHover]="true"
                   [paginator]="true"
                   [rows]="rowsPerPage"
                   [globalFilterFields]="['failure_id', 'name', 'type', 'area']"
                   currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} datos"
                   [showCurrentPageReport]="true"
                   [filterDelay]="0"
                   stripedRows
                   [scrollable]="true"
                   [scrollHeight]="scrollHeight"
                   [sortOrder]="1">
            <ng-template #caption>
              <div class="table-caption-container">
                <div class="left-section">
                  <p-button
                    [outlined]="true"
                    icon="pi pi-filter-slash"
                    label="Limpiar"
                    (click)="ClearAlerts(dtFailures)" />

                  <p-button
                    [outlined]="true"
                    icon="pi pi-plus-circle"
                    label="Nueva"
                    variant="outlined"
                    severity="info"
                    (click)="failuresData" />

                  <div class="title-text">
                    Tabla de fallas
                  </div>
                </div>

                <div class="right-section">
                  <p-button
                    *ngIf="selectedFailures.length > 0"
                    [outlined]="true"
                    icon="pi pi-delete-left"
                    label="Eliminar"
                    variant="outlined"
                    severity="danger"
                    (click)="DeleteFailure()" />

                  <p-iconField iconPosition="left">
                    <p-inputIcon>
                      <i class="fas fa-search"></i>
                    </p-inputIcon>
                    <input
                      pInputText
                      type="text"
                      [(ngModel)]="searchValueAl"
                      (input)="OnFilterGlobal($event, dtFailures)"
                      placeholder="Buscar" />
                  </p-iconField>
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 4rem" class="td-center">
                  <p-tableHeaderCheckbox/>
                </th>
                <th pSortableColumn="FailureId" style="min-width: 4rem" class="td-center">
                  <div class="flex justify-between items-center">
                    Id
                    <p-sortIcon field="FailureId" />
                    <p-columnFilter type="text" field="FailureId" display="menu" class="ml-auto" />
                  </div>
                </th>
                <th pSortableColumn="Name" style="min-width: 50rem" class="td-center">
                  <div class="flex justify-between items-center">
                    Nombre de la falla
                    <p-sortIcon field="Name" />
                    <p-columnFilter type="text" field="Name" display="menu" class="ml-auto" />
                  </div>
                </th>
                <th pSortableColumn="Type" style="min-width: 7rem">
                  <div class="flex justify-between items-center">
                    Tipo
                    <p-sortIcon field="Type" />
                    <p-columnFilter field="Type" matchMode="equals" display="menu" class="ml-auto"/>
                  </div>
                </th>
                <th pSortableColumn="Area" style="min-width: 7rem" class="td-center">
                  <div class="flex justify-between items-center">
                    Area
                    <p-sortIcon field="Area" />
                    <p-columnFilter field="Area" matchMode="equals" display="menu" class="ml-auto"/>
                  </div>
                </th>
                <th pSortableColumn="Actions" style="min-width:6rem" class="td-center">
                  <div class="flex justify-between items-center">
                    Acciones
                  </div>
                </th>
            </ng-template>
            <ng-template #body let-item>
              <tr>
                <td class="td-center">
                  <p-tableCheckbox [value]="item"/>
                </td>
                <td class="td-center">{{ item.failure_id }}</td>
                <td ><strong>{{ item.name }}</strong></td>
                <td>{{item.type}}</td>
                <td class="td-center">
                  <p-tag [value]="item.area"
                         [severity]="item.area === 'Mantenimiento' ? 'danger' : item.area === 'Almacén' ? 'info' : item.area === 'Producción' ? 'success' : item.area === 'Calidad' ? 'warn' : '' ">
                  </p-tag>
                </td>
                <td class="td-center">
                  <ion-button size="small" shape="round" color="success" (click)="EdithFailure(item)" title="Editar"
                    *ngIf="permissions.isSuperAdmin()">
                    <ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
                  </ion-button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="5">No se encontraron fallas.</td>
              </tr>
            </ng-template>
          </p-table>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>
