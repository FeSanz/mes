<ion-header [translucent]="true" style="box-shadow: none !important;">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button autoHide="false">
        <ion-button size="large" (click)="ToggleMenu()">
          <ion-icon name="menu-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-menu-button>
    </ion-buttons><ion-title>KPIs</ion-title>

    <div slot="end" class="card-select flex flex-wrap justify-center items-end gap-4">
      <p-floatlabel class="w-full md:w-56" variant="on">
        <p-select [(ngModel)]="organizationSelected" inputId="organization_select"
          [options]="userData.Company.Organizations" optionLabel="Name" [filter]="true" filterBy="Name"
          placeholder="Seleccione una organización" styleClass="w-full" [virtualScroll]="true"
          [virtualScrollItemSize]="38" (onChange)="GetMachines()" appendTo="ion-app" />
        <label for="organization_select">Organización</label>
      </p-floatlabel>
    </div>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true">
  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <ion-card>
          <p-table #dtCampaigns [value]="machinesArray" dataKey="campaign_id"
            styleClass="card-table-primeng wo-table-custom" [tableStyle]="{ 'height': '100%'}" [size]="'small'"
            [rowHover]="true" [paginator]="true" [rows]="rowsPerPage" [selectionMode]="'single'"
            [(selection)]="selectedMachine" [globalFilterFields]="['code', 'name', 'status_telegram', 'coils']"
            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
            [showCurrentPageReport]="true" [filterDelay]="0" stripedRows [scrollable]="true"
            [scrollHeight]="scrollHeight" [sortOrder]="1">

            <ng-template #caption>
              <div class="table-caption">
                <div class="table-caption-left">
                  <p-button [outlined]="true" icon="pi pi-filter-slash" label="Limpiar"
                    (click)="ClearMachinesFilter(dtCampaigns)" />
                  <div style="font-size: 17px;">
                    Máquinas
                  </div>
                </div>

                <div class="table-caption-right">
                  <p-iconField iconPosition="left">
                    <p-inputIcon>
                      <i class="fas fa-search"></i>
                    </p-inputIcon>
                    <input pInputText type="text" [(ngModel)]="searchValueAl"
                      (input)="OnFilterGlobal($event, dtCampaigns)" placeholder="Buscar" />
                  </p-iconField>
                </div>
              </div>
            </ng-template>

            <ng-template pTemplate="header">
              <tr>
                <th style="width: 4rem">
                  <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </th>
                <th pSortableColumn="code" class="td-center">
                  <div class="flex justify-between items-center">
                    Code
                    <p-sortIcon field="code" />
                    <p-columnFilter type="text" field="code" display="menu" class="ml-auto" />
                  </div>
                </th>
                <th pSortableColumn="name" class="td-center">
                  <div class="flex justify-between items-center">
                    Nombre
                    <p-sortIcon field="name" />
                    <p-columnFilter type="text" field="name" display="menu" class="ml-auto" />
                  </div>
                </th>
                <th pSortableColumn="status_telegram" class="td-center">
                  <div class="flex justify-between items-center">
                    Status
                    <p-sortIcon field="status_telegram" />
                    <p-columnFilter type="text" field="status_telegram" display="menu" class="ml-auto" />
                  </div>
                </th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-item>
              <tr class="clickable-row ion-activatable">
                <td (click)="$event.stopPropagation();">
                  <p-tableCheckbox [value]="item" (click)="$event.stopPropagation();"></p-tableCheckbox>
                </td>
                <td class="td-center">
                  <p-tag [value]="item.Code" severity="contrast"></p-tag>
                </td>
                <td class="td-center"><strong>{{ item.Name }}</strong></td>
                <td class="td-center">
                  <p-tag [value]="item.status_telegram" [severity]="item.status_telegram === 'Unschedule' ? 'warn' :
                    item.status_telegram === 'Published to MES' ? 'success' :
                    item.status_telegram === 'Published to L2' ? 'info' : 'danger'">
                  </p-tag>
                </td>
                <ion-ripple-effect></ion-ripple-effect>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8">No se encontraron máquinas para esta organización.</td>
              </tr>
            </ng-template>
          </p-table>
        </ion-card>
      </ion-col>
      <ion-col size="4">
        <ion-card class="graphic">
          <ion-card-header>
            <ion-card-title>Estadísticas</ion-card-title>
          </ion-card-header>
          <app-simple-donut [data]="donutData"></app-simple-donut>
          <ion-card-content>
          </ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col size=" 4">
        <ion-card class="graphic">
          <ion-card-header>
            <ion-card-title>Mapa de calor</ion-card-title>
          </ion-card-header>
          <app-simple-heatmap></app-simple-heatmap>
          <ion-card-content>
          </ion-card-content>
        </ion-card>
      </ion-col>
      <ion-col size="4">
        <ion-card class="graphic">
          <ion-card-header>
            <ion-card-title>Fallas más recurrentes</ion-card-title>
          </ion-card-header>
          <app-simple-column-bar></app-simple-column-bar>
          <ion-card-content>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>